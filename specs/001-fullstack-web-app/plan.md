# Implementation Plan: Phase II Full-Stack Web Application

**Branch**: `001-fullstack-web-app` | **Date**: 2026-01-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-fullstack-web-app/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Transform the Phase I in-memory CLI todo application into a robust multi-user web application with persistent database storage, secure JWT-based authentication, and a modern responsive UI. The system enables users to register accounts, securely manage their personal tasks through a web interface, with strict data isolation ensuring no user can access another user's data.

**Technical Approach**: Monorepo architecture with Next.js 16+ (App Router) frontend and FastAPI (Python 3.13+) backend, communicating via RESTful JSON APIs. Better Auth handles frontend authentication and JWT issuance, while the backend independently verifies JWT tokens using a shared secret. SQLModel ORM manages database operations with Neon Serverless PostgreSQL for persistent storage.

## Technical Context

**Language/Version**:
- Frontend: TypeScript 5.x (strict mode) with Next.js 16+ (App Router)
- Backend: Python 3.13+ with FastAPI

**Primary Dependencies**:
- Frontend: Next.js 16+, React 18+, Better Auth, Tailwind CSS 3.x, lucide-react
- Backend: FastAPI, SQLModel, Pydantic v2, python-jose (JWT), asyncpg, Alembic (migrations)

**Storage**: Neon Serverless PostgreSQL (connection pooling via asyncpg)

**Testing**:
- Backend: pytest with async support
- Frontend: Manual testing via browser (automated testing deferred)
- API: curl/Postman for endpoint verification

**Target Platform**: Modern web browsers (Chrome, Firefox, Safari, Edge - last 2 versions)

**Project Type**: Web application (monorepo with separate frontend and backend)

**Performance Goals**:
- API response time: <500ms p95 for CRUD operations
- Task creation: <3 seconds end-to-end (user action to UI update)
- Page load: <2 seconds for authenticated dashboard
- Database queries: <100ms p95 for single-user task retrieval

**Constraints**:
- Monorepo structure: `/frontend` and `/backend` at repository root
- No manual code editing (AI-generated only)
- JWT token expiration: 24 hours (configurable)
- Task title: max 200 characters
- Task description: max 2000 characters
- No pagination required (assume <1000 tasks per user)

**Scale/Scope**:
- Target: 100-1000 concurrent users (Phase II MVP scale)
- Database: Single Neon Serverless PostgreSQL instance
- Deployment: Development environment (production deployment deferred)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Spec-Driven Absolutism ✅ PASS
- ✅ Specification approved: `specs/001-fullstack-web-app/spec.md`
- ✅ Plan.md being created before implementation
- ✅ Tasks.md will be generated with unique Task IDs before coding
- ✅ All commits will reference Task IDs

### Principle II: User Isolation ✅ PASS
- ✅ All database queries will filter by authenticated user_id from JWT
- ✅ Backend validates user ownership before update/delete operations
- ✅ Server-side authorization checks enforced (never client-side only)
- ✅ Multi-user isolation testing planned in quickstart.md

### Principle III: Monorepo Separation ✅ PASS
- ✅ Separate `/frontend` and `/backend` directories at repository root
- ✅ API contracts will be defined in `specs/001-fullstack-web-app/contracts/`
- ✅ No code imports between frontend and backend
- ✅ Communication exclusively via HTTP REST APIs

### Principle IV: Stateless Architecture ✅ PASS
- ✅ Backend authenticates via JWT token in Authorization header
- ✅ user_id extracted from verified JWT claims (not request body)
- ✅ No session state stored in backend memory or database
- ✅ JWT signing secret shared between Better Auth and FastAPI

### Principle V: AI-Generated Code Only ✅ PASS
- ✅ All code will be generated by Claude Code from tasks.md
- ✅ Task IDs will be referenced in all commits
- ✅ No manual file editing permitted

### Principle VI: Simplicity and Clarity ✅ PASS
- ✅ Straightforward REST API design (no GraphQL complexity)
- ✅ Standard authentication patterns (JWT, no custom crypto)
- ✅ Minimal abstractions (direct SQLModel queries, no repository pattern)
- ✅ YAGNI: No features beyond spec requirements

### Principle VII: Security First ✅ PASS
- ✅ All API routes (except `/health` and `/auth/*`) require valid JWT
- ✅ 401 Unauthorized for missing/invalid tokens
- ✅ 403 Forbidden for insufficient permissions
- ✅ Pydantic schemas validate all request payloads
- ✅ Input sanitization prevents injection attacks

**Gate Result**: ✅ ALL CHECKS PASS - Proceed to Phase 0 Research

## Project Structure

### Documentation (this feature)

```text
specs/001-fullstack-web-app/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
│   ├── auth.yaml        # Authentication endpoints
│   └── tasks.yaml       # Task CRUD endpoints
├── checklists/
│   └── requirements.md  # Specification quality validation (completed)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py          # User model (SQLModel)
│   │   └── task.py          # Task model (SQLModel)
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py          # Dependency injection (JWT verification)
│   │   ├── auth.py          # Authentication endpoints
│   │   └── tasks.py         # Task CRUD endpoints
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py        # Environment configuration
│   │   ├── security.py      # JWT verification utilities
│   │   └── database.py      # Database connection and session
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── user.py          # User Pydantic schemas
│   │   └── task.py          # Task Pydantic schemas
│   └── main.py              # FastAPI application entry point
├── alembic/
│   ├── versions/            # Database migration files
│   └── env.py               # Alembic configuration
├── tests/
│   ├── __init__.py
│   ├── conftest.py          # Pytest fixtures
│   ├── test_auth.py         # Authentication tests
│   └── test_tasks.py        # Task CRUD tests
├── alembic.ini              # Alembic configuration
├── pyproject.toml           # Python dependencies (Poetry/pip)
├── .env.example             # Environment variables template
└── README.md                # Backend setup instructions

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx       # Root layout (App Router)
│   │   ├── page.tsx         # Landing/login page
│   │   ├── register/
│   │   │   └── page.tsx     # Registration page
│   │   ├── dashboard/
│   │   │   └── page.tsx     # Task dashboard (protected)
│   │   └── api/
│   │       └── auth/
│   │           └── [...all].ts  # Better Auth API routes
│   ├── components/
│   │   ├── ui/              # Reusable UI components
│   │   ├── TaskList.tsx     # Task list component
│   │   ├── TaskItem.tsx     # Individual task component
│   │   ├── TaskForm.tsx     # Task create/edit form
│   │   └── AuthForm.tsx     # Login/register form
│   ├── lib/
│   │   ├── auth.ts          # Better Auth configuration
│   │   ├── api.ts           # API client with JWT injection
│   │   └── types.ts         # TypeScript type definitions
│   └── styles/
│       └── globals.css      # Tailwind CSS imports
├── public/                  # Static assets
├── tests/                   # Frontend tests (deferred)
├── package.json             # Node dependencies
├── tsconfig.json            # TypeScript configuration
├── tailwind.config.ts       # Tailwind CSS configuration
├── next.config.js           # Next.js configuration
├── .env.local.example       # Environment variables template
└── README.md                # Frontend setup instructions

.specify/                    # Spec-Kit Plus templates and scripts
specs/                       # Feature specifications
history/                     # Prompt History Records and ADRs
README.md                    # Project overview and setup
.gitignore                   # Git ignore patterns
```

**Structure Decision**: Web application monorepo structure selected (Option 2 from template). This architecture provides:

1. **Clear Separation**: Frontend and backend are completely independent with no shared code imports
2. **Independent Development**: Each subsystem can be developed, tested, and run independently
3. **Technology Optimization**: Frontend uses TypeScript/React ecosystem, backend uses Python/FastAPI ecosystem
4. **API Contract Enforcement**: Communication exclusively through HTTP REST APIs defined in contracts/
5. **Scalability**: Each subsystem can be deployed and scaled independently

The structure follows Next.js 16+ App Router conventions (app/ directory) and FastAPI best practices (separation of models, schemas, API routes, and core utilities).

## Complexity Tracking

> **No violations detected** - All constitutional principles are satisfied by the planned architecture.
